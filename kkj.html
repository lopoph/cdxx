<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>修仙计算器</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      overflow-x: hidden;
    }
    h1 {
      color: #4a6fa5;
      text-align: center;
      margin-bottom: 20px;
    }
    .tab-container {
      display: flex;
      margin-bottom: 15px;
    }
    .tab {
      padding: 10px 20px;
      background-color: #e0e0e0;
      cursor: pointer;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
    }
    .tab.active {
      background-color: #4a6fa5;
      color: white;
    }
    .content-container {
      display: flex;
      width: 300%;
      transition: transform 0.3s ease;
    }
    .content-section {
      width: 33.33%;
      padding: 0 10px;
      box-sizing: border-box;
    }
    .input-section {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .input-group {
      margin-bottom: 15px;
    }
    .input-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      color: #4a6fa5;
      min-width: 80px;
    }
    input[type="number"] {
      width: 100px;
      padding: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      margin-right: 10px;
    }
    select {
      padding: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
    }
    button {
      padding: 12px;
      background-color: #4a6fa5;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
    }
    .result-section {
      background: linear-gradient(135deg, #f0f4ff, #e6eeff);
      border-radius: 10px;
      padding: 20px;
    }
    .result-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .result-label {
      font-weight: bold;
    }
    .result-value {
      font-weight: bold;
      color: #4a6fa5;
    }
    .dan-value {
      color: #d63384;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .hint {
      font-size: 0.8rem;
      color: #888;
      margin-left: 5px;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .music-controls {
      display: none;
    }
    
    /* 新增：左右并排布局样式 */
    .bonus-container {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    .bonus-box {
      flex: 1;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background-color: #f9f9f9;
    }
    .bonus-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      color: #4a6fa5;
      font-size: 1.1rem;
    }
    .bonus-input-group {
      margin-bottom: 10px;
    }
    .bonus-label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .bonus-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .bonus-hint {
      text-align: center;
      font-size: 0.8rem;
      color: #888;
      margin-top: 10px;
    }
    
    /* 滑动容器样式 */
    .swipe-container {
      width: 100%;
      overflow: hidden;
      position: relative;
    }
    .swipe-content {
      display: flex;
      transition: transform 0.3s ease;
    }
    .swipe-page {
      min-width: 100%;
      padding: 0 10px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>修仙计算器</h1>
  
  <div class="tab-container">
    <div class="tab active" onclick="switchTab('power')">战力</div>
    <div class="tab" onclick="switchTab('base')">基础</div>
    <div class="tab" onclick="switchTab('bath')">泡澡</div>
  </div>

  <!-- 滑动容器 -->
  <div class="swipe-container">
    <div class="swipe-content" id="swipe-content">
      <!-- 战力计算 -->
      <div class="swipe-page" id="power-page">
        <div class="input-section">
          <div class="input-group">
            <div class="input-row">
              <label>基础生命：</label>
              <input type="number" id="base-life" step="0.01" placeholder="输入数值">
              <select id="base-life-unit">
                <option value="1" selected>个</option>
                <option value="10000">万</option>
                <option value="100000000">亿</option>
                <option value="1000000000000">兆</option>
                <option value="10000000000000000">京</option>
                <option value="100000000000000000000">垓</option>
                <option value="1000000000000000000000000">秭</option>
                <option value="100000极00000000000000000000000000">穰</option>
                <option value="100000000000000000000000000000000">沟</option>
                <option value="1000000000000000000000000000000000000">涧</option>
                <option value="10000000000000000000000000000000000000000">正</option>
                <option value="100000000000000000000000000000000000000000000">载</option>
                <option value="1000000000000000000000000000000000000000000000000">极</option>
                <option value="10000000000000000000000000000000000000000000000000000">恒河沙</option>
                <option value="100000000000000000000000000000000000000000000000000000000">阿僧祇</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">那由他</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">不可思议</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">无量</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">大数</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">无敌</option>
              </select>
            </div>
            <div class="input-row">
              <label>基础攻击：</label>
              <input type="number" id="base-attack" step="0.01" placeholder="输入数值">
              <select id="base-attack-unit">
                <option value="1" selected>个</option>
                <option value="10000">万</option>
                <option value="100000000">亿</option>
                <option value="1000000000000">兆</option>
                <option value="10000000000000000">京</option>
                <option value="100000000000000000000">垓</option>
                <option value="1000000000000000000000000">秭</option>
                <option value="10000000000000000000000000000">穰</option>
                <option value="100000000000000000000000000000000">沟</option>
                <option value="1000000000000000000000000000000000000">涧</option>
                <option value="10000000000000000000000000000000000000000">正</option>
                <option value="100000000000000000000000000000000000000000000">载</option>
                <option value="1000000000000000000000000000000000000000000000000">极</option>
                <option value="10000000000000000000000000000000000000000000000000000">恒河沙</option>
                <option value="100000000000000000000000000000000000000000000000000000000">阿僧祇</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">那由他</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">不可思议</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">无量</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">大数</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">无敌</option>
              </select>
            </div>
          </div>

          <div class="bonus-container">
            <div class="bonus-box life-bonus">
              <div class="bonus-title">生命加成</div>
              <div class="bonus-input-group">
                <label class="bonus-label">加成：</label>
                <input type="number" id="life-bonus" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">提升：</label>
                <input type="number" id="life-boost" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">增幅：</label>
                <input type="number" id="life-amplify" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
            </div>
            
            <div class="bonus-box attack-bonus">
              <div class="bonus-title">攻击加成</div>
              <div class="bonus-input-group">
                <label class="bonus-label">加成：</label>
                <input type="number" id="attack-bonus" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">提升：</label>
                <input type="number" id="attack-boost" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">增幅：</label>
                <input type="number" id="attack-amplify" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
            </div>
          </div>
          <div class="bonus-hint">百分比不填默认为0</div>

          <button onclick="calculatePower()">计算战力</button>
        </div>
      </div>

      <!-- 基础反推 -->
      <div class="swipe-page" id="base-page">
        <div class="input-section">
          <div class="input-group">
            <div class="input-row">
              <label>目标战力：</label>
              <input type="number" id="target-power" step="0.01" placeholder="输入目标战力">
              <select id="power-unit">
                <option value="1" selected>个</option>
                <option value="10000">万</option>
                <option value="100000000">亿</option>
                <option value="1000000000000">兆</option>
                <option value="10000000000000000">京</option>
                <option value="100000000000000000000">垓</option>
                <option value="1000000000000000000000000">秭</option>
                <option value="10000000000000000000000000000">穰</option>
                <option value="100000000000000000000000000000000">沟</option>
                <option value="1000000000000000000000000000000000000">涧</option>
                <option value="10000000000000000000000000000000000000000">正</option>
                <option value="100000000000000000000000000000000000000000000">载</option>
                <option value="1000000000000000000000000000000000000000000000000">极</option>
                <option value="10000000000000000000000000000000000000000000000000000">恒河沙</option>
                <option value="100000000000000000000000000000000000000000000000000000000">阿僧祇</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">那由他</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">不可思议</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">无量</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">大数</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">无敌</option>
              </select>
            </div>
          </div>

          <div class="bonus-container">
            <div class="bonus-box life-bonus">
              <div class="bonus-title">生命加成</div>
              <div class="bonus-input-group">
                <label class="bonus-label">加成：</label>
                <input type="number" id="reverse-life-bonus" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">提升：</label>
                <input type="number" id="reverse-life-boost" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">增幅：</label>
                <input type="number" id="reverse-life-amplify" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
            </div>
            
            <div class="bonus-box attack-bonus">
              <div class="bonus-title">攻击加成</div>
              <div class="bonus-input-group">
                <label class="bonus-label">加成：</label>
                <input type="number" id="reverse-attack-bonus" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">提升：</label>
                <input type="number" id="reverse-attack-boost" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
              <div class="bonus-input-group">
                <label class="bonus-label">增幅：</label>
                <input type="number" id="reverse-attack-amplify" step="0.01" placeholder="输入百分比" class="bonus-input">
              </div>
            </div>
          </div>
          <div class="bonus-hint">百分比不填默认为0</div>

          <button onclick="reverseCalculate()">反推基础属性</button>
        </div>
      </div>

      <!-- 泡澡计算 -->
      <div class="swipe-page" id="bath-page">
        <div class="input-section">
          <div class="input-group">
            <div class="input-row">
              <label>初始战力：</label>
              <input type="number" id="initial-power-bath" step="0.01" placeholder="输入数值">
              <select id="initial-power-unit-bath">
                <option value="1" selected>个</option>
                <option value="10000">万</option>
                <option value="100000000">亿</option>
                <option value="1000000000000">兆</option>
                <option value="10000000000000000">京</option>
                <option value="100000000000000000000">垓</option>
                <option value="1000000000000000000000000">秭</option>
                <option value="10000000000000000000000000000">穰</option>
                <option value="100000000000000000000000000000000">沟</option>
                <option value="1000000000000000000000000000000000000">涧</option>
                <option value="10000000000000000000000000000000000000000">正</option>
                <option value="100000000000000000000000000000000000000000000">载</option>
                <option value="1000000000000000000000000000000000000000000000000">极</option>
                <option value="10000000000000000000000000000000000000000000000000000">恒河沙</option>
                <option value="100000000000000000000000000000000000000000000000000000000">阿僧祇</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">那由他</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">不可思议</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">无量</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">大数</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">无敌</option>
              </select>
            </div>
            <div class="input-row">
              <label>目标战力：</label>
              <input type="number" id="target-power-bath" step="0.01" placeholder="输入数值">
              <select id="target-power-unit-bath">
                <option value="1" selected>个</option>
                <option value="10000">万</option>
                <option value="100000000">亿</option>
                <option value="1000000000000">兆</option>
                <option value="10000000000000000">京</option>
                <option value="100000000000000000000">垓</option>
                <option value="1000000000000000000000000">秭</option>
                <option value="10000000000000000000000000000">穰</option>
                <option value="100000000000000000000000000000000">沟</option>
                <option value="1000000000000000000000000000000000000">涧</option>
                <option value="10000000000000000000000000000000000000000">正</option>
                <option value="100000000000000000000000000000000000000000000">载</option>
                <option value="1000000000000000000000000000000000000000000000000">极</option>
                <option value="10000000000000000000000000000000000000000000000000000">恒河沙</option>
                <option value="100000000000000000000000000000000000000000000000000000000">阿僧祇</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">那由他</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">不可思议</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">无量</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">大数</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">无敌</option>
              </select>
            </div>
          </div>

          <div class="input-group">
            <div class="input-row">
              <label>每五秒：</label>
              <input type="number" id="growth-rate" min="0.01" max="0.02" step="0.001" value="0.01" placeholder="输入百分比">
              <span class="hint">(0.01%-0.02%)</span>
            </div>
          </div>

          <button onclick="calculateBath()">计算泡澡需求</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 战力计算结果 -->
  <div class="result-section hidden" id="power-result-section">
    <h2>战力结果</h2>
    <div class="result-row">
      <span class="result-label">最终生命：</span>
      <span id="final-life" class="result-value">0 个</span>
    </div>
    <div class="result-row">
      <span class="result-label">最终攻击：</span>
      <span id="final-attack" class="result-value">0 个</span>
    </div>
    <div class="result-row">
      <span class="result-label">总战力：</span>
      <span id="total-power" class="result-value">0 个</span>
    </div>
  </div>

  <!-- 基础反推结果 -->
  <div class="result-section hidden" id="base-result-section">
    <h2>反推结果</h2>
    <div class="result-row">
      <span class="result-label">基础生命：</span>
      <span id="reverse-base-life" class="result-value">0 个</span>
    </div>
    <div class="result-row">
      <span class="result-label">基础攻击：</span>
      <span id="reverse-base-attack" class="result-value">0 个</span>
    </div>
    <div class="result-row">
      <span class="result-label">验证战力：</span>
      <span id="reverse-verify-power" class="result-value">0 个</span>
    </div>
  </div>

  <!-- 泡澡计算结果 -->
  <div class="result-section hidden" id="bath-result-section">
    <h2>泡澡结果</h2>
    <div class="result-row">
      <span class="result-label">所需时间：</span>
      <span id="bath-time-result" class="result-value">0 秒</span>
    </div>
    <div class="result-row">
      <span class="result-label">预计时间：</span>
      <span id="bath-estimate-time" class="result-value">2023/01/01 00:00</span>
    </div>
    <div class="result-row">
      <span class="result-label">需要魔丹：</span>
      <span id="bath-dan-count" class="dan-value">0 颗</span>
    </div>
  </div>

  <!-- 隐藏的音乐控制 -->
  <div class="music-controls">
    <button class="music-btn" onclick="toggleMusic()">♪</button>
  </div>

  <script>
    // 音乐播放功能
    const musicLibrary = [
      {
        name: "修仙之路",
        url: "https://music.163.com/song/media/outer/url?id=1452131330.mp3"
      },
      {
        name: "仙境漫游", 
        url: "https://music.163.com/song/media/outer/url?id=2126022114.mp3"
      },
      {
        name: "修真之境",
        url: "https://music.163.com/song/media/outer/url?id=27969765.mp3"
      }
    ];

    let currentAudio = null;
    let isMusicPlaying = false;
    let currentMusicIndex = -1;

    function playRandomMusic() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }
      
      let newIndex;
      do {
        newIndex = Math.floor(Math.random() * musicLibrary.length);
      } while (newIndex === currentMusicIndex && musicLibrary.length > 1);
      
      currentMusicIndex = newIndex;
      const music = musicLibrary[currentMusicIndex];
      
      currentAudio = new Audio(music.url);
      currentAudio.loop = true;
      currentAudio.volume = 1.0;
      
      currentAudio.play().then(() => {
        isMusicPlaying = true;
      }).catch(e => {
        console.log("自动播放被阻止");
      });
    }

    window.addEventListener('load', function() {
      setTimeout(playRandomMusic, 1000);
    });

    // 滑动切换功能
    let currentPage = 0;
    const swipeContent = document.getElementById('swipe-content');
    const pageCount = 3;
    
    // 初始化滑动位置
    swipeContent.style.transform = `translateX(0)`;
    
    // 标签页切换函数
    function switchTab(tabName) {
      let pageIndex;
      switch(tabName) {
        case 'power':
          pageIndex = 0;
          break;
        case 'base':
          pageIndex = 1;
          break;
        case 'bath':
          pageIndex = 2;
          break;
        default:
          pageIndex = 0;
      }
      
      currentPage = pageIndex;
      swipeContent.style.transform = `translateX(-${currentPage * 100}%)`;
      
      // 更新标签状态
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
      
      // 隐藏所有结果区域
      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }
    
    // 添加触摸事件处理
    let touchStartX = 0;
    let touchEndX = 0;
    const swipeContainer = document.querySelector('.swipe-container');
    
    swipeContainer.addEventListener('touchstart', function(e) {
      touchStartX = e.changedTouches[0].screenX;
    }, false);
    
    swipeContainer.addEventListener('touchend', function(e) {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, false);
    
    function handleSwipe() {
      const diff = touchStartX - touchEndX;
      
      // 向左滑动
      if (diff > 50 && currentPage < pageCount - 1) {
        currentPage++;
        swipeContent.style.transform = `translateX(-${currentPage * 100}%)`;
        updateActiveTab();
      }
      // 向右滑动
      else if (diff < -50 && currentPage > 0) {
        currentPage--;
        swipeContent.style.transform = `translateX(-${currentPage * 100}%)`;
        updateActiveTab();
      }
    }
    
    function updateActiveTab() {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      let activeTab;
      switch(currentPage) {
        case 0:
          activeTab = document.querySelector('.tab[onclick="switchTab(\'power\')"]');
          break;
        case 1:
          activeTab = document.querySelector('.tab[onclick="switchTab(\'base\')"]');
          break;
        case 2:
          activeTab = document.querySelector('.tab[onclick="switchTab(\'bath\')"]');
          break;
      }
      
      if (activeTab) {
        activeTab.classList.add('active');
      }
    }

    // 单位格式化函数
    function formatNumberWithUnit(num) {
      const units = [
        { name: "个", value: 1 },
        { name: "万", value: 10000 },
        { name: "亿", value: 100000000 },
        { name: "兆", value: 1000000000000 },
        { name: "京", value: 10000000000000000 },
        { name: "垓", value: 100000000000000000000 },
        { name: "秭", value: 1000000000000000000000000 },
        { name: "穰", value: 10000000000000000000000000000 },
        { name: "沟", value: 100000000000000000000000000000000 },
        { name: "涧", value: 1000000000000000000000000000000000000 },
        { name: "正", value: 10000000000000000000000000000000000000000 },
        { name: "载", value: 100000000000000000000000000000000000000000000 },
        { name: "极", value: 1000000000000000000000000000000000000000000000000 },
        { name: "恒河沙", value: 10000000000000000000000000000000000000000000000000000 },
        { name: "阿僧祇", value: 100000000000000000000000000000000000000000000000000000000 },
        { name: "那由他", value: 1000000000000000000000000000000000000000000000000000000000000 },
        { name: "不可思议", value: 10000000000000000000000000000000000000000000000000000000000000000 },
        { name: "无量", value: 100000000000000000000000000000000000000000000000000000000000000000000 },
        { name: "大数", value: 1000000000000000000000000000000000000000000000000000000000000000000000000 },
        { name: "无敌", value: 10000000000000000000000000000000000000000000000000000000000000000000000000000 }
      ];
      
      if (num === 0) return "0 个";
      
      for (let i = units.length - 1; i >= 0; i--) {
        if (num >= units[i].value) {
          return (num / units[i].value).toFixed(2) + " " + units[i].name;
        }
      }
      return num.toFixed(2) + " 个";
    }

    // 战力计算函数
    function calculatePower() {
      const baseLife = parseFloat(document.getElementById('base-life').value) || 0;
      const baseLifeUnit = parseFloat(document.getElementById('base-life-unit').value) || 1;
      const baseAttack = parseFloat(document.getElementById('base-attack').value) || 0;
      const baseAttackUnit = parseFloat(document.getElementById('base-attack-unit').value) || 1;
      
      const lifeBonus = parseFloat(document.getElementById('life-bonus').value) || 0;
      const lifeBoost = parseFloat(document.getElementById('life-boost').value) || 0;
      const lifeAmplify = parseFloat(document.getElementById('life-amplify').value) || 0;
      
      const attackBonus = parseFloat(document.getElementById('attack-bonus').value) || 0;
      const attackBoost = parseFloat(document.getElementById('attack-boost').value) || 0;
      const attackAmplify = parseFloat(document.getElementById('attack-amplify').value) || 0;
      
      const lifeMultiplier = (1 + lifeBonus/100) * (1 + lifeBoost/100) * (1 + lifeAmplify/100);
      const attackMultiplier = (1 + attackBonus/100) * (1 + attackBoost/100) * (1 + attackAmplify/100);
      
      const finalLife = baseLife * baseLifeUnit * lifeMultiplier;
      const finalAttack = baseAttack * baseAttackUnit * attackMultiplier;
      const totalPower = finalLife + 5 * finalAttack;
      
      document.getElementById('final-life').textContent = formatNumberWithUnit(finalLife);
      document.getElementById('final-attack').textContent = formatNumberWithUnit(finalAttack);
      document.getElementById('total-power').textContent = formatNumberWithUnit(totalPower);
      
      document.getElementById('power-result-section').classList.remove('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }

    // 基础反推函数
    function reverseCalculate() {
      const targetPower = parseFloat(document.getElementById('target-power').value) || 0;
      const powerUnit = parseFloat(document.getElementById('power-unit').value) || 1;
      const totalPower = targetPower * powerUnit;
      
      const lifeBonus = parseFloat(document.getElementById('reverse-life-bonus').value) || 0;
      const lifeBoost = parseFloat(document.getElementById('reverse-life-boost').value) || 0;
      const lifeAmplify = parseFloat(document.getElementById('reverse-life-amplify').value) || 0;
      
      const attackBonus = parseFloat(document.getElementById('reverse-attack-bonus').value) || 0;
      const attackBoost = parseFloat(document.getElementById('reverse-attack-boost').value) || 0;
      const attackAmplify = parseFloat(document.getElementById('reverse-attack-amplify').value) || 0;
      
      const lifeMultiplier = (1 + lifeBonus/100) * (1 + lifeBoost/100) * (1 + lifeAmplify/100);
      const attackMultiplier = (1 + attackBonus/100) * (1 + attackBoost/100) * (1 + attackAmplify/100);
      
      const baseAttack = totalPower / (5 * (lifeMultiplier + attackMultiplier));
      const baseLife = 5 * baseAttack;
      
      const verifyLife = baseLife * lifeMultiplier;
      const verifyAttack = baseAttack * attackMultiplier;
      const verifyPower = verifyLife + 5 * verifyAttack;
      
      document.getElementById('reverse-base-life').textContent = formatNumberWithUnit(baseLife);
      document.getElementById('reverse-base-attack').textContent = formatNumberWithUnit(baseAttack);
      document.getElementById('reverse-verify-power').textContent = formatNumberWithUnit(verifyPower);
      
      document.getElementById('base-result-section').classList.remove('hidden');
      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }

    // 泡澡计算函数
    function calculateBath() {
      const initialPower = parseFloat(document.getElementById('initial-power-bath').value) || 0;
      const initialUnit = parseFloat(document.getElementById('initial-power-unit-bath').value) || 1;
      const targetPower = parseFloat(document.getElementById('target-power-bath').value) || 0;
      const targetUnit = parseFloat(document.getElementById('target-power-unit-bath').value) || 1;
      const growthRate = parseFloat(document.getElementById('growth-rate').value) || 0.01;
      
      const initial = initialPower * initialUnit;
      const target = targetPower * targetUnit;
      
      if (initial <= 0 || target <= initial) {
        alert("初始战力必须大于0且目标战力必须大于初始战力");
        return;
      }
      
      const growthFactor = 1 + growthRate / 100;
      let current = initial;
      let timeCount = 0;
      
      while (current < target) {
        current *= growthFactor;
        timeCount++;
      }
      
      const totalSeconds = timeCount * 5;
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      let timeString = "";
      if (days > 0) timeString += `${days}天`;
      if (hours > 0) timeString += `${hours}小时`;
      if (minutes > 0) timeString += `${minutes}分钟`;
      timeString += `${seconds}秒`;
      
      const now = new Date();
      const completionDate = new Date(now.getTime() + totalSeconds * 1000);
      const formattedDate = completionDate.getFullYear() + '/' + 
                           String(completionDate.getMonth() + 1).padStart(2, '0') + '/' + 
                           String(completionDate.getDate()).padStart(2, '0') + ' ' + 
                           String(completionDate.getHours()).padStart(2, '0') + ':' + 
                           String(completionDate.getMinutes()).padStart(2, '0');
      
      const danFactor = 1.0001;
      current = initial;
      let danCount = 0;
      
      while (current < target) {
        current *= danFactor;
        danCount++;
      }
      
      document.getElementById('bath-time-result').textContent = timeString;
      document.getElementById('bath-estimate-time').textContent = formattedDate;
      document.getElementById('bath-dan-count').textContent = danCount.toLocaleString() + "颗";
      
      document.getElementById('bath-result-section').classList.remove('hidden');
      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
    }
  </script>
</body>
</html>
