<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ä¿®ä»™è®¡ç®—å™¨</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
#music-info {
    position: fixed;
    top: 15px;
    left: 0;
    font-size: 14px;
    color: #4a6fa5;
    background: transparent;
    padding: 6px 12px;
    z-index: 1001;
    display: none;
    white-space: nowrap;
    pointer-events: none;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(255,255,255,0.8);
    font-family: 'Microsoft YaHei', Arial, sans-serif;
    will-change: transform;
}

/* æ­Œæ›²åç§°åŠ¨ç”» - æ»šåŠ¨3æ¬¡ */
@keyframes songScroll {
    0% { 
        transform: translateX(100vw); 
    }
    100% { 
        transform: translateX(calc(-100% - 20px)); /* ç¡®ä¿å®Œå…¨æ»šå‡º */
    }
}

/* é”™è¯¯ä¿¡æ¯åŠ¨ç”» - æ»šåŠ¨1æ¬¡ */
@keyframes errorScroll {
    0% { 
        transform: translateX(100vw); 
    }
    100% { 
        transform: translateX(calc(-100% - 20px)); /* ç¡®ä¿å®Œå…¨æ»šå‡º */
    }
}

/* æ‰«é›·ç•Œé¢ä¸­ä¿æŒæ˜¾ç¤º */
#mine-game #music-info {
    z-index: 1003;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
    #music-info {
        font-size: 12px;
        top: 10px;
        padding: 4px 8px;
    }
}


    
    
    
    
    
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* æ‰«é›·æ¸¸æˆæ ·å¼ */
    .mine-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background-color: #ff5555;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .mine-game {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      z-index: 1001;
      padding: 20px;
      box-sizing: border-box;
      overflow: auto;
    }

    .mine-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 20px;
      color: #4a6fa5;
    }

    .difficulty-selector {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .difficulty-btn {
      padding: 10px 20px;
      background-color: #4a6fa5;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    .game-info-container {
      display: flex;
      flex-direction: column;
      height: calc(100% - 150px);
    }

    .game-info-container.hidden {
      display: none;
    }

    .game-info {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }

    .mine-time-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 5px;
    }

    #mine-count, #game-time {
      min-width: 120px;
      font-size: 1.1rem;
    }

    #mine-count {
      text-align: left;
    }

    #game-time {
      text-align: right;
    }

    .flag-mode-row {
      display: flex;
      justify-content: center;
      width: 100%;
    }

    .mine-board {
      display: grid;
      grid-template-columns: repeat(var(--cols, 8), 1fr);
      gap: 2px;
      margin: 0 auto;
      width: 90%;
      max-width: 100%;
      flex-grow: 1;
    }

    .mine-cell {
      aspect-ratio: 1;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .mine-cell span {
      display: inline-block;
      transform: scale(0.85);
      line-height: 1;
    }

    .mine-board.easy .mine-cell {
      font-size: 24px;
    }

    .mine-board.medium .mine-cell {
      font-size: 18px;
    }

    .mine-board.hard .mine-cell {
      font-size: 14px;
    }

    .mine-cell.revealed {
      background-color: #f5f5f5;
    }

    .mine-cell.flagged {
      background-color: #ffcccc;
    }

    .mine-cell.mine {
      background-color: #ff5555;
      color: white;
    }

    /* ç²¾å‡†å®šä½æ’æ——æŒ‰é’®æ ·å¼ */
    #flag-mode-btn {
      padding: 4px 10px !important;
      margin: 0 auto !important;
      background-color: #4a6fa5 !important;
      color: white !important;
      border: none !important;
      border-radius: 4px !important;
      font-size: 0.95rem !important;
      line-height: 1.25 !important;
      box-shadow: none !important;
      width: auto !important;
      display: inline-block !important;
    }

    #flag-mode-btn.active {
      background-color: #ff5555 !important;
      padding: 4px 10px !important;
    }

    /* ç¡®ä¿æŒ‰é’®å®¹å™¨ä¸é™åˆ¶å®½åº¦ */
    .flag-mode-row {
      padding: 0 !important;
      margin: 5px 0 !important;
    }

    .game-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .control-btn {
      padding: 10px 20px;
      background-color: #4a6fa5;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    .exit-btn {
      background-color: #ff5555;
    }
    
    /* æ•°å­—é¢œè‰²æ ·å¼ */
    .mine-cell .number-1 {
      color: #0000FF;
    }

    .mine-cell .number-2 {
      color: #008000;
    }

    .mine-cell .number-3 {
      color: #FF0000;
    }

    .mine-cell .number-4 {
      color: #800080;
    }

    .mine-cell .number-5 {
      color: #800000;
    }

    /* æ—‹è½¬åŠ¨ç”» */
    .rotating-image {
      animation: rotation 3s infinite linear;
      display: inline-block;
      vertical-align: middle;
    }

    @keyframes rotation {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(359deg);
      }
    }

    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      touch-action: pan-y;
      overflow-x: hidden;
    }

    h1 {
      color: #4a6fa5;
      text-align: center;
      margin-bottom: 0;
      padding-bottom: 0px;
    }

    .qq-group-section {
      margin: 10px auto;
      padding: 5px 10px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* æ ‡ç­¾é¡µå®¹å™¨ä¼˜åŒ– */
    .tab-container {
      display: flex;
      margin-bottom: 10px;
      width: 100%;
      height: 50px;
    }

    .tab {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #e0e0e0;
      cursor: pointer;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .tab.active {
      background-color: #4a6fa5;
      color: white;
    }

    .tab:hover {
      background-color: #d0d0d0;
    }

    .tab.active:hover {
      background-color: #3a5f95;
    }

    /* å†…å®¹åŒºåŸŸæ»‘åŠ¨åŠ¨ç”» */
    .content-container {
      position: relative;
      overflow: hidden;
      height: auto;
      touch-action: pan-y;
    }

    .tab-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      opacity: 0;
      transform: translateX(100%);
      transition: transform 0.4s ease, opacity 0.4s ease;
      pointer-events: none;
    }

    .tab-content.active {
      position: relative;
      opacity: 1;
      transform: translateX(0);
      pointer-events: all;
    }

    .tab-content.slide-left {
      transform: translateX(-100%);
    }

    .tab-content.slide-right {
      transform: translateX(100%);
    }

    .input-section {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      touch-action: pan-y;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    label {
      font-weight: bold;
      color: #4a6fa5;
      min-width: 80px;
    }

    input[type="number"] {
      width: 100px;
      padding: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      margin-right: 10px;
    }

    select {
      padding: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      width: 90px;
      margin-left: -3%;
    }

    button {
      padding: 12px;
      background-color: #4a6fa5;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
    }

    .result-section {
      background: linear-gradient(135deg, #f0f4ff, #e6eeff);
      border-radius: 10px;
      padding: 20px;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .result-label {
      font-weight: bold;
    }

    .result-value {
      font-weight: bold;
      color: #4a6fa5;
    }

    .dan-value {
      color: #d63384;
      font-weight: bold;
    }

    .hidden {
      display: none;
    }

    .hint {
      font-size: 0.8rem;
      color: #888;
      margin-left: 5px;
    }

    /* åŠ æˆåŒºåŸŸæ ·å¼ */
    .bonus-container {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      margin-left: -4%;
    }

    .bonus-box {
      flex: 1;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
    }

    .life-bonus {
      background-color: #e6f7e6;
    }

    .attack-bonus {
      background-color: #ffe6e6;
    }

    .bonus-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .bonus-input-group {
      margin-bottom: 10px;
    }

    .bonus-label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .bonus-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .bonus-hint {
      text-align: center;
      font-size: 0.8rem;
      color: #888;
      margin-top: 10px;
    }

    /* æ–°å¢æ ·å¼ï¼šåŸºç¡€ç”Ÿå‘½å’ŒåŸºç¡€æ”»å‡»èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% */
    .base-attributes-group {
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .base-attributes-group .input-row input[type="number"] {
      width: 70px;
    }

    /* ç›®æ ‡æˆ˜åŠ›èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% */
    .target-power-group {
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .target-power-group .input-row input[type="number"] {
      width: 70px;
    }

    /* åˆå§‹æˆ˜åŠ›å’Œç›®æ ‡æˆ˜åŠ›èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% */
    .bath-power-group {
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .bath-power-group .input-row input[type="number"] {
      width: 70px;
    }

    /* æ¯äº”ç§’èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% */
    .growth-rate-group {
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .growth-rate-group .input-row input[type="number"] {
      width: 70px;
    }

    .copy-btn {
      padding: 2px 8px;
      background: #4a6fa5;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      width: auto;
      min-width: 40px;
      white-space: nowrap;
    }
    
    
    
    
    
    
 #giftIcon {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10000;
  cursor: pointer;
  font-size: 32px; /* ç¨å¾®è°ƒå¤§å­—ä½“ */
  transition: all 0.5s ease;
  
  /* ç§»é™¤èƒŒæ™¯è‰²å’Œè¾¹æ¡†ï¼Œè®©å›¾æ ‡æœ¬èº«å‘å…‰ */
  background: none;
  border: none;
  width: auto;
  height: auto;
  border-radius: 0;
  box-shadow: none;
  
  /* æ·»åŠ å‘å…‰æ•ˆæœ */
  filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
  text-shadow: 
    0 0 20px rgba(255, 215, 0, 0.9),
    0 0 40px rgba(255, 215, 0, 0.6),
    0 0 60px rgba(255, 215, 0, 0.3);
}

/* é¼ æ ‡æ‚¬åœæ—¶å¢å¼ºå‘å…‰æ•ˆæœ */
#giftIcon:hover {
  filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1));
  text-shadow: 
    0 0 25px rgba(255, 215, 0, 1),
    0 0 50px rgba(255, 215, 0, 0.8),
    0 0 75px rgba(255, 215, 0, 0.5);
  transform: scale(1.1);
}

/* é¢æ¿å±•å¼€æ—¶çš„å‘å…‰æ•ˆæœ */
#giftIcon.active {
  filter: drop-shadow(0 0 20px rgba(255, 100, 100, 1));
  text-shadow: 
    0 0 30px rgba(255, 100, 100, 1),
    0 0 60px rgba(255, 100, 100, 0.8),
    0 0 90px rgba(255, 100, 100, 0.5);
}


    /* ç»Ÿè®¡é¢æ¿æ ·å¼ */
    #statsPanel {
      position: fixed;
      top: 80px;
      left: 20px;
      z-index: 9999;
      display: none;
      flex-direction: column;
      gap: 12px;
      background: linear-gradient(135deg, rgba(40,40,60,0.95) 0%, rgba(30,30,50,0.95) 100%);
      padding: 20px;
      border-radius: 16px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,215,0,0.3);
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      min-width: 220px;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    
  </style>
</head>

<body>
<!-- éŸ³ä¹ä¿¡æ¯æ˜¾ç¤ºå®¹å™¨ - æ·»åŠ åˆ°<body>æ ‡ç­¾å†…çš„ä»»æ„ä½ç½® -->

<!-- ç¤¼ç‰©å›¾æ ‡ -->
  <div id="giftIcon">ğŸ</div>

  <!-- ç»Ÿè®¡é¢æ¿ -->
  <div id="statsPanel">
    <!-- é¢æ¿æ ‡é¢˜ -->
    <div style="text-align: center; color: #FFD700; font-size: 16px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 0 8px rgba(255,215,0,0.5);">
      âœ¨ ä¿®ä»™ç»Ÿè®¡ âœ¨
    </div>

    <!-- è®¿é—®é‡ç»Ÿè®¡ -->
    <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: rgba(74, 111, 165, 0.3); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
      <div style="color: #E0E0E0; font-size: 14px;">
        <span style="margin-right: 8px;">ğŸ‘ï¸</span>è®¿é—®é‡
      </div>
      <div id="visitCount" style="color: #4FC3F7; font-weight: bold; font-size: 16px; text-shadow: 0 0 6px rgba(79,195,247,0.6);">
        åŠ è½½ä¸­...
      </div>
    </div>

    <!-- ç‚¹èµåŠŸèƒ½ -->
    <div style="padding: 12px; background: rgba(255, 107, 107, 0.3); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
        <div style="color: #E0E0E0; font-size: 14px;">
          <span style="margin-right: 8px;">ğŸ‘</span>ç‚¹èµæ•°
        </div>
        <div id="likeCount" style="color: #FF6B6B; font-weight: bold; font-size: 16px; text-shadow: 0 0 6px rgba(255,107,107,0.6);">
          åŠ è½½ä¸­...
        </div>
      </div>
      
      <div style="display: flex; gap: 8px; align-items: center;">
        <button id="likeButton" style="flex: 1; background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%); border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px; box-shadow: 0 4px 12px rgba(255,107,107,0.4); transition: all 0.3s;">
          ğŸ’– ç‚¹èµ +1
        </button>
      </div>
      
      <div id="likeMessage" style="font-size: 12px; text-align: center; margin-top: 8px; height: 18px; opacity: 0; transition: opacity 0.3s;"></div>
    </div>

    <!-- æç¤ºæ–‡å­— -->
    <div style="text-align: center; color: #888; font-size: 11px; font-style: italic;">
      å½“ç„¶å®éªŒ
    </div>
  </div>




  <h1 style="display: flex; align-items: center; justify-content: center;">
    <i class="fas fa-yin-yang rotating-image" style="color: #4a6fa5; font-size: 40px; margin-right: 15px;"></i>
    ä¿®ä»™è®¡ç®—å™¨
  </h1>

  <div class="qq-group-section">
    <span>æœ‰è¦æ”¹è¿›çš„åœ°æ–¹å¯è¿›QQç¾¤è¯´ï¼š371408377</span>
    <button onclick="copyQQGroup()" class="copy-btn">å¤åˆ¶</button>
  </div>

  <div class="tab-container">
    <div class="tab active" onclick="switchTab('power', 0)">æˆ˜åŠ›</div>
    <div class="tab" onclick="switchTab('base', 1)">åŸºç¡€</div>
    <div class="tab" onclick="switchTab('bath', 2)">æ³¡æ¾¡</div>
  </div>

  <div class="content-container" id="content-container">
    <div class="input-section">
      <!-- æˆ˜åŠ›è®¡ç®— -->
      <div id="power-tab" class="tab-content active">
        <!-- åŸºç¡€ç”Ÿå‘½å’ŒåŸºç¡€æ”»å‡» - èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% -->
        <div class="base-attributes-group">
          <div class="input-group">
            <div class="input-row">
              <label>åŸºç¡€ç”Ÿå‘½ï¼š</label>
              <input type="number" id="base-life" step="0.01" placeholder="è¾“å…¥æ•°å€¼">
              <select id="base-life-unit">
                <option value="1" selected>ä¸ª</option>
                <option value="10000">ä¸‡</option>
                <option value="100000000">äº¿</option>
                <option value="1000000000000">å…†</option>
                <option value="10000000000000000">äº¬</option>
                <option value="100000000000000000000">å“</option>
                <option value="1000000000000000000000000">ç§­</option>
                <option value="10000000000000000000000000000">ç©°</option>
                <option value="100000000000000000000000000000000">æ²Ÿ</option>
                <option value="1000000000000000000000000000000000000">æ¶§</option>
                <option value="10000000000000000000000000000000000000000">æ­£</option>
                <option value="100000000000000000000000000000000000000000000">è½½</option>
                <option value="1000000000000000000000000000000000000000000000000">æ</option>
                <option value="10000000000000000000000000000000000000000000000000000">æ’æ²³æ²™</option>
                <option value="100000000000000000000000000000000000000000000000000000000">é˜¿åƒ§ç¥‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">é‚£ç”±ä»–</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">ä¸å¯æ€è®®</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">æ— é‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">å¤§æ•°</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">æ— æ•Œ</option>
              </select>
            </div>
            <div class="input-row">
              <label>åŸºç¡€æ”»å‡»ï¼š</label>
              <input type="number" id="base-attack" step="0.01" placeholder="è¾“å…¥æ•°å€¼">
              <select id="base-attack-unit">
                <option value="1" selected>ä¸ª</option>
                <option value="10000">ä¸‡</option>
                <option value="100000000">äº¿</option>
                <option value="1000000000000">å…†</option>
                <option value="10000000000000000">äº¬</option>
                <option value="100000000000000000000">å“</option>
                <option value="1000000000000000000000000">ç§­</option>
                <option value="10000000000000000000000000000">ç©°</option>
                <option value="100000000000000000000000000000000">æ²Ÿ</option>
                <option value="1000000000000000000000000000000000000">æ¶§</option>
                <option value="10000000000000000000000000000000000000000">æ­£</option>
                <option value="100000000000000000000000000000000000000000000">è½½</option>
                <option value="1000000000000000000000000000000000000000000000000">æ</option>
                <option value="10000000000000000000000000000000000000000000000000000">æ’æ²³æ²™</option>
                <option value="100000000000000000000000000000000000000000000000000000000">é˜¿åƒ§ç¥‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">é‚£ç”±ä»–</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">ä¸å¯æ€è®®</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">æ— é‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">å¤§æ•°</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">æ— æ•Œ</option>
              </select>
            </div>
          </div>
        </div>

        <div class="bonus-container">
          <div class="bonus-box life-bonus">
            <div class="bonus-title">ç”Ÿå‘½</div>
            <div class="bonus-input-group">
              <label class="bonus-label">åŠ æˆï¼š</label>
              <input type="number" id="life-bonus" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">æå‡ï¼š</label>
              <input type="number" id="life-boost" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input" oninput="syncBoostValues('power', 'life', this.value)">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">å¢å¹…ï¼š</label>
              <input type="number" id="life-amplify" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
          </div>
          
          <div class="bonus-box attack-bonus">
            <div class="bonus-title">æ”»å‡»</div>
            <div class="bonus-input-group">
              <label class="bonus-label">åŠ æˆï¼š</label>
              <input type="number" id="attack-bonus" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">æå‡ï¼š</label>
              <input type="number" id="attack-boost" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input" oninput="syncBoostValues('power', 'attack', this.value)">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">å¢å¹…ï¼š</label>
              <input type="number" id="attack-amplify" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
          </div>
        </div>
        <div class="bonus-hint">ä¸å¡«é»˜è®¤ä¸º0</div>

        <button onclick="calculatePower()">è®¡ç®—æˆ˜åŠ›</button>
      </div>

      <!-- åŸºç¡€åæ¨ -->
      <div id="base-tab" class="tab-content">
        <!-- ç›®æ ‡æˆ˜åŠ› - èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% -->
        <div class="target-power-group">
          <div class="input-group">
            <div class="input-row">
              <label>ç›®æ ‡æˆ˜åŠ›ï¼š</label>
              <input type="number" id="target-power" step="0.01" placeholder="è¾“å…¥æ•°å€¼">
              <select id="power-unit">
                <option value="1" selected>ä¸ª</option>
                <option value="10000">ä¸‡</option>
                <option value="100000000">äº¿</option>
                <option value="1000000000000">å…†</option>
                <option value="10000000000000000">äº¬</option>
                <option value="100000000000000000000">å“</option>
                <option value="1000000000000000000000000">ç§­</option>
                <option value="10000000000000000000000000000">ç©°</option>
                <option value="100000000000000000000000000000000">æ²Ÿ</option>
                <option value="1000000000000000000000000000000000000">æ¶§</option>
                <option value="10000000000000000000000000000000000000000">æ­£</option>
                <option value="100000000000000000000000000000000000000000000">è½½</option>
                <option value="1000000000000000000000000000000000000000000000000">æ</option>
                <option value="10000000000000000000000000000000000000000000000000000">æ’æ²³æ²™</option>
                               <option value="100000000000000000000000000000000000000000000000000000000">é˜¿åƒ§ç¥‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">é‚£ç”±ä»–</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">ä¸å¯æ€è®®</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">æ— é‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">å¤§æ•°</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">æ— æ•Œ</option>
              </select>
            </div>
          </div>
        </div>

        <div class="bonus-container">
          <div class="bonus-box life-bonus">
            <div class="bonus-title">ç”Ÿå‘½</div>
            <div class="bonus-input-group">
              <label class="bonus-label">åŠ æˆï¼š</label>
              <input type="number" id="reverse-life-bonus" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">æå‡ï¼š</label>
              <input type="number" id="reverse-life-boost" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input" oninput="syncBoostValues('base', 'life', this.value)">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">å¢å¹…ï¼š</label>
              <input type="number" id="reverse-life-amplify" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
          </div>
          
          <div class="bonus-box attack-bonus">
            <div class="bonus-title">æ”»å‡»</div>
            <div class="bonus-input-group">
              <label class="bonus-label">åŠ æˆï¼š</label>
              <input type="number" id="reverse-attack-bonus" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">æå‡ï¼š</label>
              <input type="number" id="reverse-attack-boost" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input" oninput="syncBoostValues('base', 'attack', this.value)">
            </div>
            <div class="bonus-input-group">
              <label class="bonus-label">å¢å¹…ï¼š</label>
              <input type="number" id="reverse-attack-amplify" step="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”" class="bonus-input">
            </div>
          </div>
        </div>
        <div class="bonus-hint">ä¸å¡«é»˜è®¤ä¸º0</div>

        <button onclick="reverseCalculate()">åæ¨åŸºç¡€å±æ€§</button>
      </div>

      <!-- æ³¡æ¾¡è®¡ç®— -->
      <div id="bath-tab" class="tab-content">
        <!-- åˆå§‹æˆ˜åŠ›å’Œç›®æ ‡æˆ˜åŠ› - èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% -->
        <div class="bath-power-group">
          <div class="input-group">
            <div class="input-row">
              <label>åˆå§‹æˆ˜åŠ›ï¼š</label>
              <input type="number" id="initial-power-bath" step="0.01" placeholder="è¾“å…¥æ•°å€¼">
              <select id="initial-power-unit-bath">
                <option value="1" selected>ä¸ª</option>
                <option value="10000">ä¸‡</option>
                <option value="100000000">äº¿</option>
                <option value="1000000000000">å…†</option>
                <option value="10000000000000000">äº¬</option>
                <option value="100000000000000000000">å“</option>
                <option value="1000000000000000000000000">ç§­</option>
                <option value="10000000000000000000000000000">ç©°</option>
                <option value="100000000000000000000000000000000">æ²Ÿ</option>
                <option value="1000000000000000000000000000000000000">æ¶§</option>
                <option value="10000000000000000000000000000000000000000">æ­£</option>
                <option value="100000000000000000000000000000000000000000000">è½½</option>
                <option value="1000000000000000000000000000000000000000000000000">æ</option>
                <option value="10000000000000000000000000000000000000000000000000000">æ’æ²³æ²™</option>
                <option value="100000000000000000000000000000000000000000000000000000000">é˜¿åƒ§ç¥‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">é‚£ç”±ä»–</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">ä¸å¯æ€è®®</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">æ— é‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">å¤§æ•°</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">æ— æ•Œ</option>
              </select>
            </div>
            <div class="input-row">
              <label>ç›®æ ‡æˆ˜åŠ›ï¼š</label>
              <input type="number" id="target-power-bath" step="0.01" placeholder="è¾“å…¥æ•°å€¼">
              <select id="target-power-unit-bath">
                <option value="1" selected>ä¸ª</option>
                <option value="10000">ä¸‡</option>
                <option value="100000000">äº¿</option>
                <option value="1000000000000">å…†</option>
                <option value="10000000000000000">äº¬</option>
                <option value="100000000000000000000">å“</option>
                <option value="1000000000000000000000000">ç§­</option>
                <option value="10000000000000000000000000000">ç©°</option>
                <option value="100000000000000000000000000000000">æ²Ÿ</option>
                <option value="1000000000000000000000000000000000000">æ¶§</option>
                <option value="10000000000000000000000000000000000000000">æ­£</option>
                <option value="100000000000000000000000000000000000000000000">è½½</option>
                <option value="1000000000000000000000000000000000000000000000000">æ</option>
                <option value="10000000000000000000000000000000000000000000000000000">æ’æ²³æ²™</option>
                <option value="100000000000000000000000000000000000000000000000000000000">é˜¿åƒ§ç¥‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000">é‚£ç”±ä»–</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000">ä¸å¯æ€è®®</option>
                <option value="100000000000000000000000000000000000000000000000000000000000000000000">æ— é‡</option>
                <option value="1000000000000000000000000000000000000000000000000000000000000000000000000">å¤§æ•°</option>
                <option value="10000000000000000000000000000000000000000000000000000000000000000000000000000">æ— æ•Œ</option>
              </select>
            </div>
          </div>
        </div>

        <!-- æ¯äº”ç§’ - èƒŒæ™¯ç°è‰²ï¼Œè¾“å…¥æ¡†å‡å°‘30% -->
        <div class="growth-rate-group">
          <div class="input-group">
            <div class="input-row">
              <label>æ¯æ¬¡å¢åŠ ï¼š</label>
              <input type="number" id="growth-rate" min="0.01" max="0.02" step="0.001" value="0.01" placeholder="è¾“å…¥ç™¾åˆ†æ¯”">
              <span class="hint">(0.01%-0.02%)</span>
            </div>
          </div>
        </div>

        <button onclick="calculateBath()">è®¡ç®—æ³¡æ¾¡éœ€æ±‚</button>
      </div>
    </div>
  </div>

  <!-- æˆ˜åŠ›è®¡ç®—ç»“æœ -->
  <div class="result-section hidden" id="power-result-section">
    <h2>æˆ˜åŠ›ç»“æœ</h2>
    <div class="result-row">
      <span class="result-label">æœ€ç»ˆç”Ÿå‘½ï¼š</span>
      <span id="final-life" class="result-value">0 ä¸ª</span>
    </div>
    <div class="result-row">
      <span class="result-label">æœ€ç»ˆæ”»å‡»ï¼š</span>
      <span id="final-attack" class="result-value">0 ä¸ª</span>
    </div>
    <div class="result-row">
      <span class="result-label">æ€»æˆ˜åŠ›ï¼š</span>
      <span id="total-power" class="result-value">0 ä¸ª</span>
    </div>
  </div>

  <!-- åŸºç¡€åæ¨ç»“æœ -->
  <div class="result-section hidden" id="base-result-section">
    <h2>åæ¨ç»“æœ</h2>
    <div class="result-row">
      <span class="result-label">åŸºç¡€ç”Ÿå‘½ï¼š</span>
      <span id="reverse-base-life" class="result-value">0 ä¸ª</span>
    </div>
    <div class="result-row">
      <span class="result-label">åŸºç¡€æ”»å‡»ï¼š</span>
      <span id="reverse-base-attack" class="result-value">0 ä¸ª</span>
    </div>
    <div class="result-row">
      <span class="result-label">éªŒè¯æˆ˜åŠ›ï¼š</span>
      <span id="reverse-verify-power" class="result-value">0 ä¸ª</span>
    </div>
  </div>

  <!-- æ³¡æ¾¡è®¡ç®—ç»“æœ -->
  <div class="result-section hidden" id="bath-result-section">
    <h2>æ³¡æ¾¡ç»“æœ</h2>
    <div class="result-row">
      <span class="result-label">æ‰€éœ€æ—¶é—´ï¼š</span>
      <span id="bath-time-result" class="result-value">0 ç§’</span>
    </div>
    <div class="result-row">
      <span class="result-label">é¢„è®¡æ—¶é—´ï¼š</span>
      <span id="bath-estimate-time" class="result-value">2023/01/01 00:00</span>
    </div>
    <div class="result-row">
      <span class="result-label">éœ€è¦é­”ä¸¹ï¼š</span>
      <span id="bath-dan-count" class="dan-value">0 é¢—</span>
    </div>
  </div>

  <!-- æ‰«é›·æ¸¸æˆå›¾æ ‡ -->
  <div class="mine-icon" onclick="openMineGame()">ğŸ’£</div>

  <!-- æ‰«é›·æ¸¸æˆç•Œé¢ -->
  <div id="mine-game" class="mine-game">
    <h1 class="mine-title">æ‰«é›·æ¸¸æˆ</h1>
    
    <div class="difficulty-selector">
      <button class="difficulty-btn" onclick="startGame(8, 8, 10)">ç®€å•æ¨¡å¼</button>
      <button class="difficulty-btn" onclick="startGame(12, 12, 20)">ä¸­ç­‰æ¨¡å¼</button>
      <button class="difficulty-btn" onclick="startGame(16, 16, 40)">å›°éš¾æ¨¡å¼</button>
    </div>
    
    <div id="game-info-container" class="game-info-container hidden">
      <div class="game-info">
        <div class="mine-time-row">
          <div id="mine-count">å‰©ä½™ç‚¸å¼¹: 0</div>
          <div id="game-time">æ—¶é—´: 00:00:00</div>
        </div>
        <div class="flag-mode-row">
          <button id="flag-mode-btn" class="flag-mode-btn" onclick="toggleFlagMode()">æ’æ——æ¨¡å¼(å…³)</button>
        </div>
      </div>
      
      <div id="mine-board" class="mine-board"></div>
      
      <div class="game-controls">
        <button class="control-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        <button class="control-btn exit-btn" onclick="exitGame()">é€€å‡ºæ¸¸æˆ</button>
      </div>
    </div>
  </div>

  <script>
  
  
/// ==================== å®æ—¶ç»Ÿè®¡åŠŸèƒ½ ====================
// æ–‡ä»¶å: statistics.js
// åŠŸèƒ½: å¤„ç†ç¤¼ç‰©å›¾æ ‡äº¤äº’ã€è®¿é—®é‡ç»Ÿè®¡ã€ç‚¹èµåŠŸèƒ½

let statsPanelVisible = false;
let statsInitialized = false;

// ä¿®æ”¹ç¤¼ç‰©å›¾æ ‡ç‚¹å‡»äº‹ä»¶ä¸­çš„æ ·å¼æ§åˆ¶
document.getElementById('giftIcon').addEventListener('click', function() {
    statsPanelVisible = !statsPanelVisible;
    const panel = document.getElementById('statsPanel');
    const gift = document.getElementById('giftIcon');
    
    if (statsPanelVisible) {
        // æ˜¾ç¤ºé¢æ¿
        panel.style.display = 'flex';
        gift.textContent = 'ğŸ‰';
        gift.classList.add('active'); // æ·»åŠ æ¿€æ´»çŠ¶æ€
        
        // é¦–æ¬¡å±•å¼€æ—¶åŠ è½½æ•°æ®
        if (!statsInitialized) {
            loadStatistics();
            statsInitialized = true;
        }
    } else {
        // éšè—é¢æ¿
        panel.style.display = 'none';
        gift.textContent = 'ğŸ';
        gift.classList.remove('active'); // ç§»é™¤æ¿€æ´»çŠ¶æ€
    }
});

// ä¿®æ”¹æ‚¬åœæ•ˆæœï¼ˆç§»é™¤èƒŒæ™¯è‰²å˜åŒ–ï¼‰
const giftIcon = document.getElementById('giftIcon');
giftIcon.addEventListener('mouseenter', function() {
    if (!statsPanelVisible) {
        this.style.transform = 'scale(1.1)';
    }
});

giftIcon.addEventListener('mouseleave', function() {
    if (!statsPanelVisible) {
        this.style.transform = 'scale(1)';
    }
});

// åŠ è½½ç»Ÿè®¡æ•°æ®
async function loadStatistics() {
    try {
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        document.getElementById('visitCount').textContent = 'åŠ è½½ä¸­...';
        document.getElementById('likeCount').textContent = 'åŠ è½½ä¸­...';
        
        // ä»GitHub Pagesæ‰˜ç®¡çš„JSONæ–‡ä»¶è¯»å–æ•°æ®
        const response = await fetch('/counters/data.json?t=' + Date.now());
        const data = await response.json();
        
        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('visitCount').textContent = data.visits || 0;
        document.getElementById('likeCount').textContent = data.likes || 0;
        
        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç‚¹èµ
        const today = new Date().toDateString();
        if (localStorage.getItem('xiuxianLiked_' + today)) {
            disableLikeButton();
        }
        
        console.log('ç»Ÿè®¡åŠ è½½å®Œæˆ', data);
    } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
        document.getElementById('visitCount').textContent = '0';
        document.getElementById('likeCount').textContent = '0';
    }
}

// ç‚¹èµåŠŸèƒ½
async function addLike() {
    const today = new Date().toDateString();
    
    // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»ç‚¹è¿‡èµ
    if (localStorage.getItem('xiuxianLiked_' + today)) {
        showMessage('ä»Šå¤©å·²ç»ç‚¹è¿‡èµå•¦ï¼æ˜å¤©å†æ¥å§~', '#FF9800');
        return;
    }
    
    const likeButton = document.getElementById('likeButton');
    const originalText = likeButton.textContent;
    
    // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
    likeButton.disabled = true;
    likeButton.textContent = 'ç‚¹èµä¸­...';
    likeButton.style.opacity = '0.7';
    
    try {
        // ä¹è§‚æ›´æ–°ï¼šç«‹å³å¢åŠ UIæ˜¾ç¤º
        const currentCount = parseInt(document.getElementById('likeCount').textContent) || 0;
        const newCount = currentCount + 1;
        document.getElementById('likeCount').textContent = newCount;
        
        // æ ‡è®°ä»Šå¤©å·²ç‚¹èµ
        localStorage.setItem('xiuxianLiked_' + today, 'true');
        disableLikeButton();
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showMessage('æ„Ÿè°¢ç‚¹èµï¼ä¿®ä»™ä¹‹è·¯å› ä½ æ›´ç²¾å½©~', '#4CAF50');
        
        // ç‚¹èµåŠ¨ç”»æ•ˆæœ
        likeButton.style.transform = 'scale(1.2)';
        setTimeout(() => {
            likeButton.style.transform = 'scale(1)';
        }, 300);
        
        // è§¦å‘GitHub Actionsæ›´æ–°ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
        triggerCounterUpdate('likes');
        
    } catch (error) {
        console.error('ç‚¹èµå¤±è´¥:', error);
        likeButton.disabled = false;
        likeButton.textContent = originalText;
        likeButton.style.opacity = '1';
        showMessage('ç‚¹èµå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', '#FF5252');
    }
}

// è§¦å‘è®¡æ•°å™¨æ›´æ–°ï¼ˆè°ƒç”¨GitHub Actionsï¼‰
async function triggerCounterUpdate(type) {
    try {
        // è¿™é‡Œå¯ä»¥è°ƒç”¨GitHub Actions APIè¿›è¡Œå®æ—¶æ›´æ–°
        // æš‚æ—¶å…ˆç”¨ç®€å•çš„fetchè¯·æ±‚
        await fetch(`/api/update-${type}`, { method: 'POST' });
    } catch (error) {
        // å¿½ç•¥é”™è¯¯ï¼Œè¿™åªæ˜¯å¯é€‰çš„å®æ—¶æ›´æ–°åŠŸèƒ½
        console.log('å®æ—¶æ›´æ–°åŠŸèƒ½æš‚ä¸å¯ç”¨');
    }
}

// ç¦ç”¨ç‚¹èµæŒ‰é’®
function disableLikeButton() {
    const likeButton = document.getElementById('likeButton');
    likeButton.disabled = true;
    likeButton.style.opacity = '0.6';
    likeButton.textContent = 'å·²èµ';
    likeButton.style.background = 'linear-gradient(135deg, #666, #888)';
}

// æ˜¾ç¤ºæ¶ˆæ¯
function showMessage(text, color) {
    const messageEl = document.getElementById('likeMessage');
    messageEl.textContent = text;
    messageEl.style.color = color;
    messageEl.style.opacity = '1';
    
    setTimeout(() => {
        messageEl.style.opacity = '0';
    }, 3000);
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è®°å½•è®¿é—®é‡
function initStatistics() {
    // é˜²åˆ·æ–°åˆ·é‡ï¼šåŒä¼šè¯åªè®°å½•ä¸€æ¬¡
    const sessionKey = 'xiuxian_visit_session';
    if (!sessionStorage.getItem(sessionKey)) {
        sessionStorage.setItem(sessionKey, 'true');
        
        // å»¶è¿Ÿè®°å½•è®¿é—®é‡
        setTimeout(() => {
            // è¿™é‡Œå¯ä»¥è§¦å‘è®¿é—®é‡æ›´æ–°
            triggerCounterUpdate('visits');
        }, 2000);
    }
    
    // æ·»åŠ ç¤¼ç‰©å›¾æ ‡æ‚¬åœæ•ˆæœ
    const giftIcon = document.getElementById('giftIcon');
    giftIcon.addEventListener('mouseenter', function() {
        if (!statsPanelVisible) {
            this.style.transform = 'scale(1.1) rotate(-10deg)';
            this.style.textShadow = '0 0 20px rgba(255,215,0,1)';
        }
    });
    
    giftIcon.addEventListener('mouseleave', function() {
        if (!statsPanelVisible) {
            this.style.transform = 'scale(1) rotate(0deg)';
            this.style.textShadow = '0 0 10px rgba(255,215,0,0.8)';
        }
    });
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç»Ÿè®¡åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    initStatistics();
});

// å¯¼å‡ºå‡½æ•°ä¾›å…¶ä»–è„šæœ¬ä½¿ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        loadStatistics,
        addLike,
        showMessage,
        initStatistics
    };
}


  
  
// ===== å®Œæ•´éŸ³ä¹æ’­æ”¾å™¨ =====
const musicPlayer = (function() {
    // éŸ³ä¹åº“
    const songs = [
        { name: "unravel   é”™çš„ä¸æ˜¯æˆ‘è€Œæ˜¯è¿™ä¸ªä¸–ç•ŒğŸ˜ˆ", url: "https://music.163.com/song/media/outer/url?id=1452131330.mp3" },
        { name: "call of silence ä¸ºäº†å¤§æµ·å¡”å¡”å¼€ğŸ¤“ ", url: "https://music.163.com/song/media/outer/url?id=2126022114.mp3" },
        { name: "é’é¸Ÿ  ç ‚ä¸–å˜ğŸ‘‡ğŸ‘†ğŸ‘ˆ   é‚£é²å¤šâœŒï¸ğŸ––ğŸ‘ˆğŸ¤˜", url: "https://music.163.com/song/media/outer/url?id=27969765.mp3" }
    ];
    
    // æ’­æ”¾çŠ¶æ€
    let currentAudio = null;
    let isPlaying = false;
    let currentSong = null;
    let retryCount = 0;
    const playHistory = [];
    const maxHistory = 3;
    
    // åˆ›å»ºéŸ³ä¹ä¿¡æ¯å…ƒç´ 
    const musicInfoEl = document.createElement('div');
    musicInfoEl.id = 'music-info';
    document.body.appendChild(musicInfoEl);
    
    // è·å–éšæœºæ­Œæ›²ï¼ˆæ’é™¤å½“å‰æ’­æ”¾ï¼‰
    function getRandomSong(excludeUrl = null) {
        const availableSongs = songs.filter(song => !excludeUrl || song.url !== excludeUrl);
        return availableSongs.length > 0 ? 
            availableSongs[Math.floor(Math.random() * availableSongs.length)] : 
            songs[0];
    }
    
    // ç²¾ç¡®è®¡ç®—æ–‡æœ¬å®½åº¦
    function getTextWidth(text) {
        const span = document.createElement('span');
        span.style.font = '14px "Microsoft YaHei", Arial, sans-serif';
        span.style.position = 'absolute';
        span.style.left = '-9999px';
        span.style.whiteSpace = 'nowrap';
        span.textContent = text;
        document.body.appendChild(span);
        const width = span.offsetWidth;
        document.body.removeChild(span);
        return width;
    }
    
    // æ˜¾ç¤ºéŸ³ä¹ä¿¡æ¯ï¼ˆå¸¦ç²¾ç¡®æ»šåŠ¨æ§åˆ¶ï¼‰
    function showMusicInfo(text, isError = false) {
        // é‡ç½®çŠ¶æ€
        musicInfoEl.style.display = 'block';
        musicInfoEl.textContent = text;
        musicInfoEl.style.width = 'auto';
        musicInfoEl.style.maxWidth = 'none';
        
        // è®¡ç®—æ–‡å­—å’Œå±å¹•å®½åº¦
        const textWidth = getTextWidth(text);
        const screenWidth = window.innerWidth;
        
        // åŠ¨æ€è°ƒæ•´é€Ÿåº¦ï¼ˆä¿è¯é˜…è¯»ä½“éªŒï¼‰
        const baseSpeed = 100; // åƒç´ /ç§’
        const totalDistance = textWidth + screenWidth;
        const duration = Math.max(8, totalDistance / baseSpeed); // æœ€å°‘8ç§’
        
        // è®¾ç½®åŠ¨ç”»
        musicInfoEl.style.animation = `${isError ? 'errorScroll' : 'songScroll'} ${duration}s linear ${isError ? 1 : 3}`;
        
        // åŠ¨ç”»ç»“æŸå¤„ç†
const onAnimationEnd = () => {
    // æ— è®ºæ˜¯é”™è¯¯ä¿¡æ¯è¿˜æ˜¯æ­Œè¯ï¼ŒåŠ¨ç”»ç»“æŸåéƒ½éšè—
    musicInfoEl.style.display = 'none';
    musicInfoEl.style.animation = 'none';
};

        
        musicInfoEl.addEventListener('animationend', onAnimationEnd, { once: true });
    }
    
    // æ’­æ”¾éŸ³ä¹æ ¸å¿ƒé€»è¾‘
    function play(song = null) {
        if (isPlaying) return;
        
        const playSong = song || getRandomSong(currentSong?.url);
        if (!playSong) return;
        
        currentSong = playSong;
        updateHistory(playSong);
        
        currentAudio = new Audio(playSong.url);
        currentAudio.volume = 0.5;
        
        currentAudio.oncanplay = () => {
            currentAudio.play()
                .then(() => {
                    isPlaying = true;
                    retryCount = 0;
                    showMusicInfo(playSong.name);
                })
                .catch(err => {
                    console.error('æ’­æ”¾å¤±è´¥:', err);
                    showMusicInfo('æ’­æ”¾å¤±è´¥', true);
                    if (retryCount < 1) {
                        retryCount++;
                        setTimeout(() => play(playSong), 500);
                    }
                });
        };
        
        currentAudio.onerror = () => {
            showMusicInfo('åŠ è½½å¤±è´¥', true);
            if (retryCount < 1) {
                retryCount++;
                setTimeout(() => play(playSong), 500);
            }
        };
        
        currentAudio.onended = () => {
            resetPlayer();
            setTimeout(() => play(getRandomSong(currentSong.url)), 1000);
        };
    }
    
    // é‡ç½®æ’­æ”¾å™¨
    function resetPlayer() {
        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }
        isPlaying = false;
        musicInfoEl.style.display = 'none';
        musicInfoEl.style.animation = 'none';
    }
    
    // æ›´æ–°æ’­æ”¾å†å²
    function updateHistory(song) {
        playHistory.unshift(song);
        if (playHistory.length > maxHistory) playHistory.pop();
    }
    
    return {
        trigger: function() {
            if (!isPlaying) play();
        },
        getCurrentSong: function() {
            return currentSong;
        },
        getHistory: function() {
            return [...playHistory];
        }
    };
})();

// ===== äº¤äº’è§¦å‘è®¾ç½® =====
function setupMusicTriggers() {
    // ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', () => musicPlayer.trigger());
    
    // è§¦æ‘¸æ»‘åŠ¨
    let touchStartX = 0;
    document.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
    });
    document.addEventListener('touchend', (e) => {
        if (Math.abs(e.changedTouches[0].clientX - touchStartX) > 30) {
            musicPlayer.trigger();
        }
    });
    
    // é”®ç›˜äº‹ä»¶
    document.addEventListener('keydown', () => musicPlayer.trigger());
    
    // è¾“å…¥å˜åŒ–
    document.querySelectorAll('input, select, textarea').forEach(el => {
        el.addEventListener('input', () => musicPlayer.trigger());
    });
    
    // åˆå§‹éšæœºæ’­æ”¾
    setTimeout(() => musicPlayer.trigger(), 1500);
}

// é¡µé¢åŠ è½½åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', setupMusicTriggers);



    // æ ‡ç­¾é¡µåˆ‡æ¢å˜é‡
    let currentTabIndex = 0;
    const tabOrder = ['power', 'base', 'bath'];

    // è§¦æ‘¸æ»‘åŠ¨ç›¸å…³å˜é‡
    let startX = 0;
    let currentX = 0;
    let isSwiping = false;
    const swipeThreshold = 80;

    // åˆå§‹åŒ–è§¦æ‘¸äº‹ä»¶
    function initSwipe() {
      const container = document.getElementById('content-container');
      
      container.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        currentX = startX;
        isSwiping = true;
      });
      
      container.addEventListener('touchmove', function(e) {
        if (!isSwiping) return;
        currentX = e.touches[0].clientX;
        
        if (Math.abs(currentX - startX) > 10) {
          e.preventDefault();
        }
      });
      
      container.addEventListener('touchend', function(e) {
        if (!isSwiping) return;
        
        const deltaX = currentX - startX;
        
        if (Math.abs(deltaX) > swipeThreshold) {
          if (deltaX > 0) {
            switchTabBySwipe(-1);
          } else {
            switchTabBySwipe(1);
          }
        }
        
        isSwiping = false;
        startX = 0;
        currentX = 0;
      });
    }

    // é€šè¿‡æ»‘åŠ¨åˆ‡æ¢æ ‡ç­¾é¡µ
    function switchTabBySwipe(direction) {
      let newTabIndex = currentTabIndex + direction;
      
      if (newTabIndex < 0) {
        newTabIndex = tabOrder.length - 1;
      } else if (newTabIndex >= tabOrder.length) {
        newTabIndex = 0;
      }
      
      if (newTabIndex !== currentTabIndex) {
        switchTab(tabOrder[newTabIndex], newTabIndex);
      }
    }

    // æ ‡ç­¾é¡µåˆ‡æ¢å‡½æ•°
    function switchTab(tabName, tabIndex) {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');
      const oldTabIndex = currentTabIndex;
      currentTabIndex = tabIndex;

      tabs.forEach(tab => tab.classList.remove('active'));
      tabs[tabIndex].classList.add('active');

      contents.forEach(content => {
        if (content.classList.contains('active')) {
          if (tabIndex > oldTabIndex) {
            content.classList.add('slide-left');
          } else {
            content.classList.add('slide-right');
          }
          content.classList.remove('active');
        }
      });

      setTimeout(() => {
        contents.forEach(content => {
          content.classList.remove('slide-left', 'slide-right');
          if (content.id === tabName + '-tab') {
            content.classList.add('active');
          }
        });
      }, 50);

      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }

    // å•ä½æ ¼å¼åŒ–å‡½æ•°
    function formatNumberWithUnit(num) {
      const units = [
        { name: "ä¸ª", value: 1 },
        { name: "ä¸‡", value: 10000 },
        { name: "äº¿", value: 100000000 },
        { name: "å…†", value: 1000000000000 },
        { name: "äº¬", value: 10000000000000000 },
        { name: "å“", value: 100000000000000000000 },
        { name: "ç§­", value: 1000000000000000000000000 },
        { name: "ç©°", value: 10000000000000000000000000000 },
        { name: "æ²Ÿ", value: 100000000000000000000000000000000 },
        { name: "æ¶§", value: 1000000000000000000000000000000000000 },
        { name: "æ­£", value: 10000000000000000000000000000000000000000 },
        { name: "è½½", value: 100000000000000000000000000000000000000000000 },
        { name: "æ", value: 1000000000000000000000000000000000000000000000000 },
        { name: "æ’æ²³æ²™", value: 10000000000000000000000000000000000000000000000000000 },
        { name: "é˜¿åƒ§ç¥‡", value: 100000000000000000000000000000000000000000000000000000000 },
        { name: "é‚£ç”±ä»–", value: 1000000000000000000000000000000000000000000000000000000000000 },
        { name: "ä¸å¯æ€è®®", value: 10000000000000000000000000000000000000000000000000000000000000000 },
        { name: "æ— é‡", value: 100000000000000000000000000000000000000000000000000000000000000000000 },
        { name: "å¤§æ•°", value: 1000000000000000000000000000000000000000000000000000000000000000000000000 },
        { name: "æ— æ•Œ", value: 10000000000000000000000000000000000000000000000000000000000000000000000000000 }
      ];
      
      if (num === 0) return "0 ä¸ª";
      
      for (let i = units.length - 1; i >= 0; i--) {
        if (num >= units[i].value) {
          return (num / units[i].value).toFixed(2) + " " + units[i].name;
        }
      }
      return num.toFixed(2) + " ä¸ª";
    }

      // æˆ˜åŠ›è®¡ç®—å‡½æ•°
    function calculatePower() {
      const baseLife = parseFloat(document.getElementById('base-life').value) || 0;
      const baseLifeUnit = parseFloat(document.getElementById('base-life-unit').value) || 1;
      const baseAttack = parseFloat(document.getElementById('base-attack').value) || 0;
      const baseAttackUnit = parseFloat(document.getElementById('base-attack-unit').value) || 1;
      
      const lifeBonus = parseFloat(document.getElementById('life-bonus').value) || 0;
      const lifeBoost = parseFloat(document.getElementById('life-boost').value) || 0;
      const lifeAmplify = parseFloat(document.getElementById('life-amplify').value) || 0;
      
      const attackBonus = parseFloat(document.getElementById('attack-bonus').value) || 0;
      const attackBoost = parseFloat(document.getElementById('attack-boost').value) || 0;
      const attackAmplify = parseFloat(document.getElementById('attack-amplify').value) || 0;
      
      const lifeMultiplier = (1 + lifeBonus/100) * (1 + lifeBoost/100) * (1 + lifeAmplify/100);
      const attackMultiplier = (1 + attackBonus/100) * (1 + attackBoost/100) * (1 + attackAmplify/100);
      
      const finalLife = baseLife * baseLifeUnit * lifeMultiplier;
      const finalAttack = baseAttack * baseAttackUnit * attackMultiplier;
      const totalPower = finalLife + 5 * finalAttack;
      
      document.getElementById('final-life').textContent = formatNumberWithUnit(finalLife);
      document.getElementById('final-attack').textContent = formatNumberWithUnit(finalAttack);
      document.getElementById('total-power').textContent = formatNumberWithUnit(totalPower);
      
      document.getElementById('power-result-section').classList.remove('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }

    // åŸºç¡€åæ¨å‡½æ•°
    function reverseCalculate() {
      const targetPower = parseFloat(document.getElementById('target-power').value) || 0;
      const powerUnit = parseFloat(document.getElementById('power-unit').value) || 1;
      const totalPower = targetPower * powerUnit;
      
      const lifeBonus = parseFloat(document.getElementById('reverse-life-bonus').value) || 0;
      const lifeBoost = parseFloat(document.getElementById('reverse-life-boost').value) || 0;
      const lifeAmplify = parseFloat(document.getElementById('reverse-life-amplify').value) || 0;
      
      const attackBonus = parseFloat(document.getElementById('reverse-attack-bonus').value) || 0;
      const attackBoost = parseFloat(document.getElementById('reverse-attack-boost').value) || 0;
      const attackAmplify = parseFloat(document.getElementById('reverse-attack-amplify').value) || 0;
      
      const lifeMultiplier = (1 + lifeBonus/100) * (1 + lifeBoost/100) * (1 + lifeAmplify/100);
      const attackMultiplier = (1 + attackBonus/100) * (1 + attackBoost/100) * (1 + attackAmplify/100);
      
      const baseAttack = totalPower / (5 * (lifeMultiplier + attackMultiplier));
      const baseLife = 5 * baseAttack;
      
      const verifyLife = baseLife * lifeMultiplier;
      const verifyAttack = baseAttack * attackMultiplier;
      const verifyPower = verifyLife + 5 * verifyAttack;
      
      document.getElementById('reverse-base-life').textContent = formatNumberWithUnit(baseLife);
      document.getElementById('reverse-base-attack').textContent = formatNumberWithUnit(baseAttack);
      document.getElementById('reverse-verify-power').textContent = formatNumberWithUnit(verifyPower);
      
      document.getElementById('base-result-section').classList.remove('hidden');
      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('bath-result-section').classList.add('hidden');
    }


    // æ³¡æ¾¡è®¡ç®—å‡½æ•°
    function calculateBath() {
      const initialPower = parseFloat(document.getElementById('initial-power-bath').value) || 0;
      const initialUnit = parseFloat(document.getElementById('initial-power-unit-bath').value) || 1;
      const targetPower = parseFloat(document.getElementById('target-power-bath').value) || 0;
      const targetUnit = parseFloat(document.getElementById('target-power-unit-bath').value) || 1;
      const growthRate = parseFloat(document.getElementById('growth-rate').value) || 0.01;
      
      const initial = initialPower * initialUnit;
      const target = targetPower * targetUnit;
      
      // éªŒè¯é€»è¾‘
      if (initial <= 0) {
        alert("åˆå§‹æˆ˜åŠ›å¿…é¡»å¤§äº0");
        return;
      }
      
      if (target <= initial) {
        alert("ç›®æ ‡æˆ˜åŠ›å¿…é¡»å¤§äºåˆå§‹æˆ˜åŠ›");
        return;
      }
      
      const growthFactor = 1 + growthRate / 100;
      let current = initial;
      let timeCount = 0;
      
      while (current < target) {
        current *= growthFactor;
        timeCount++;
      }
      
      const totalSeconds = timeCount * 5;
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      let timeString = "";
      if (days > 0) timeString += `${days}å¤©`;
      if (hours > 0) timeString += `${hours}å°æ—¶`;
      if (minutes > 0) timeString += `${minutes}åˆ†é’Ÿ`;
      timeString += `${seconds}ç§’`;
      
      const now = new Date();
      const completionDate = new Date(now.getTime() + totalSeconds * 1000);
      const formattedDate = completionDate.getFullYear() + '/' + 
                           String(completionDate.getMonth() + 1).padStart(2, '0') + '/' + 
                           String(completionDate.getDate()).padStart(2, '0') + ' ' + 
                           String(completionDate.getHours()).padStart(2, '0') + ':' + 
                           String(completionDate.getMinutes()).padStart(2, '0');
      
      const danFactor = 1.0001;
      current = initial;
      let danCount = 0;
      
      while (current < target) {
        current *= danFactor;
        danCount++;
      }
      
      document.getElementById('bath-time-result').textContent = timeString;
      document.getElementById('bath-estimate-time').textContent = formattedDate;
      document.getElementById('bath-dan-count').textContent = danCount.toLocaleString() + "é¢—";
      
      document.getElementById('bath-result-section').classList.remove('hidden');
      document.getElementById('power-result-section').classList.add('hidden');
      document.getElementById('base-result-section').classList.add('hidden');
    }

    // æå‡æ•°å€¼åŒæ­¥å‡½æ•°
    function syncBoostValues(tabType, inputType, value) {
      if (value === '') {
        if (tabType === 'power') {
          if (inputType === 'life') {
            document.getElementById('attack-boost').value = '';
          } else if (inputType === 'attack') {
            document.getElementById('life-boost').value = '';
          }
        } else if (tabType === 'base') {
          if (inputType === 'life') {
            document.getElementById('reverse-attack-boost').value = '';
          } else if (inputType === 'attack') {
            document.getElementById('reverse-life-boost').value = '';
          }
        }
        return;
      }
      
      const numericValue = parseFloat(value);
      if (isNaN(numericValue)) return;
      
      if (tabType === 'power') {
        if (inputType === 'life') {
          document.getElementById('attack-boost').value = value;
        } else if (inputType === 'attack') {
          document.getElementById('life-boost').value = value;
        }
      } else if (tabType === 'base') {
        if (inputType === 'life') {
          document.getElementById('reverse-attack-boost').value = value;
        } else if (inputType === 'attack') {
          document.getElementById('reverse-life-boost').value = value;
        }
      }
    }

    // QQç¾¤å¤åˆ¶åŠŸèƒ½
    function copyQQGroup() {
      const text = "371408377";
      
      const input = document.createElement('textarea');
      input.value = text;
      input.style.position = 'fixed';
      input.style.opacity = '0';
      document.body.appendChild(input);
      
      input.select();
      input.setSelectionRange(0, 99999);
      
      try {
        const successful = document.execCommand('copy');
        document.body.removeChild(input);
        
        if (successful) {
          showCopySuccess();
        } else {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + text);
        }
      } catch (err) {
        document.body.removeChild(input);
        alert('è¯·æ‰‹åŠ¨å¤åˆ¶QQç¾¤å·ï¼š' + text);
      }
    }

    // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
    function showCopySuccess() {
      const toast = document.createElement('div');
      toast.textContent = 'âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
      toast.style.position = 'fixed';
      toast.style.bottom = '50px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.backgroundColor = 'rgba(0,0,0,0.7)';
      toast.style.color = 'white';
      toast.style.padding = '10px 20px';
      toast.style.borderRadius = '5px';
      toast.style.zIndex = '1000';
      toast.style.fontSize = '14px';
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 2000);
    }

    // æ‰«é›·æ¸¸æˆå˜é‡
    let mineBoard = [];
    let rows = 0;
    let cols = 0;
    let mineCount = 0;
    let flaggedCount = 0;
    let revealedCount = 0;
    let gameOver = false;
    let gameStartTime = 0;
    let timerInterval = null;
    let flagMode = false;

    // æ‰“å¼€æ‰«é›·æ¸¸æˆ
    function openMineGame() {
      document.getElementById('mine-game').style.display = 'block';
      document.getElementById('game-info-container').classList.add('hidden');
    }

    // å¼€å§‹æ¸¸æˆ
    function startGame(r, c, m) {
      rows = r;
      cols = c;
      mineCount = m;
      flaggedCount = 0;
      revealedCount = 0;
      gameOver = false;
      flagMode = false;
      
      document.getElementById('game-info-container').classList.remove('hidden');
      document.getElementById('flag-mode-btn').classList.remove('active');
      document.getElementById('flag-mode-btn').textContent = 'æ’æ——æ¨¡å¼(å…³)';
      
      if (timerInterval) clearInterval(timerInterval);
      gameStartTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);
      
      initializeBoard();
      updateMineCount();
      updateTimer();
    }

    // åˆå§‹åŒ–æ£‹ç›˜
    function initializeBoard() {
      const boardElement = document.getElementById('mine-board');
      boardElement.style.setProperty('--cols', cols);
      
      boardElement.className = 'mine-board';
      if (rows === 8) boardElement.classList.add('easy');
      else if (rows === 12) boardElement.classList.add('medium');
      else boardElement.classList.add('hard');
      
      boardElement.innerHTML = '';
      
      // åˆ›å»ºäºŒç»´æ•°ç»„
      mineBoard = Array(rows).fill().map(() => Array(cols).fill(0));
      
      // æ”¾ç½®ç‚¸å¼¹
      let minesPlaced = 0;
      while (minesPlaced < mineCount) {
        const x = Math.floor(Math.random() * rows);
        const y = Math.floor(Math.random() * cols);
        
        if (mineBoard[x][y] !== -1) {
          mineBoard[x][y] = -1;
          minesPlaced++;
          
          // æ›´æ–°å‘¨å›´æ ¼å­çš„æ•°å­—
          for (let dx = -1; dx <= 1; dx++) {
            for (let dy = -1; dy <= 1; dy++) {
              const nx = x + dx;
              const ny = y + dy;
              
              if (nx >= 0 && nx < rows && ny >= 0 && ny < cols && mineBoard[nx][ny] !== -1) {
                mineBoard[nx][ny]++;
              }
            }
          }
        }
      }
      
      // åˆ›å»ºæ ¼å­å…ƒç´ 
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const cell = document.createElement('div');
          cell.className = 'mine-cell';
          cell.dataset.x = i;
          cell.dataset.y = j;
          
          const contentSpan = document.createElement('span');
          cell.appendChild(contentSpan);
          
          cell.addEventListener('click', function() {
            if (!gameOver) {
              if (flagMode) {
                flagCell(i, j);
              } else {
                revealCell(i, j);
              }
            }
          });
          
          cell.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            if (!gameOver) flagCell(i, j);
          });
          
          let pressTimer;
          cell.addEventListener('touchstart', function() {
            pressTimer = setTimeout(() => {
              if (!gameOver) flagCell(i, j);
            }, 500);
          });
          
          cell.addEventListener('touchend', function() {
            clearTimeout(pressTimer);
          });
          
          boardElement.appendChild(cell);
        }
      }
    }

    // åˆ‡æ¢æ’æ——æ¨¡å¼
    function toggleFlagMode() {
      flagMode = !flagMode;
      const btn = document.getElementById('flag-mode-btn');
      if (flagMode) {
        btn.classList.add('active');
        btn.textContent = 'æ’æ——æ¨¡å¼(å¼€)';
      } else {
        btn.classList.remove('active');
        btn.textContent = 'æ’æ——æ¨¡å¼(å…³)';
      }
    }

    // æ­ç¤ºæ ¼å­
    function revealCell(x, y) {
      const cell = document.querySelector(`.mine-cell[data-x="${x}"][data-y="${y}"]`);
      const contentSpan = cell.querySelector('span');
      
      if (cell.classList.contains('revealed') || cell.classList.contains('flagged')) {
        return;
      }
      
      cell.classList.add('revealed');
      revealedCount++;
      
      if (mineBoard[x][y] === -1) {
        cell.classList.add('mine');
        contentSpan.innerHTML = '<span class="emoji">ğŸ’£</span>';
        gameOver = true;
        revealAllMines();
        clearInterval(timerInterval);
        setTimeout(() => alert('æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°äº†ç‚¸å¼¹ï¼'), 10);
      } else if (mineBoard[x][y] > 0) {
        let displayNumber = mineBoard[x][y];
        if (rows === 8) displayNumber = Math.min(displayNumber, 3);
        else if (rows === 12) displayNumber = Math.min(displayNumber, 4);
        else displayNumber = Math.min(displayNumber, 5);
        
        contentSpan.innerHTML = `<span class="number-${displayNumber}">${displayNumber}</span>`;
      } else {
        for (let dx = -1; dx <= 1; dx++) {
          for (let dy = -1; dy <= 1; dy++) {
            const nx = x + dx;
            const ny = y + dy;
            
            if (nx >= 0 && nx < rows && ny >= 0 && ny < cols) {
              revealCell(nx, ny);
            }
          }
        }
      }
      
      checkWinCondition();
    }

    // æ’æ——
    function flagCell(x, y) {
      const cell = document.querySelector(`.mine-cell[data-x="${x}"][data-y="${y}"]`);
      const contentSpan = cell.querySelector('span');
      
      if (cell.classList.contains('revealed')) {
        return;
      }
      
      if (cell.classList.contains('flagged')) {
        cell.classList.remove('flagged');
        contentSpan.innerHTML = '';
        flaggedCount--;
      } else {
        cell.classList.add('flagged');
        contentSpan.innerHTML = '<span class="emoji">ğŸš©</span>';
        flaggedCount++;
      }
      
      updateMineCount();
      
      if (flaggedCount === mineCount) {
        checkFlagAccuracy();
      }
    }

    // æ£€æŸ¥æ——å¸œä½ç½®å‡†ç¡®æ€§
    function checkFlagAccuracy() {
      let correctFlags = 0;
      
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const cell = document.querySelector(`.mine-cell[data-x="${i}"][data-y="${j}"]`);
          if (cell.classList.contains('flagged') && mineBoard[i][j] === -1) {
            correctFlags++;
          }
        }
      }
      
      if (correctFlags !== mineCount) {
        gameOver = true;
        clearInterval(timerInterval);
        revealAllMines();
        setTimeout(() => alert('æ¸¸æˆç»“æŸï¼ä½ çš„æ’æ——ä½ç½®æœ‰è¯¯ï¼'), 10);
      } else {
        gameOver = true;
        clearInterval(timerInterval);
        revealAllCellsExceptFlags();
        setTimeout(() => alert('æ­å–œä½ èµ¢äº†ï¼æ‰€æœ‰ç‚¸å¼¹éƒ½è¢«æ­£ç¡®æ ‡è®°ï¼'), 10);
      }
    }

    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    function checkWinCondition() {
      if (revealedCount === rows * cols - mineCount && !gameOver) {
        gameOver = true;
        clearInterval(timerInterval);
        revealAllCellsExceptFlags();
        setTimeout(() => alert('æ­å–œä½ èµ¢äº†ï¼'), 10);
      }
      
      if (!gameOver) {
        let allFlagsCorrect = true;
        for (let i = 0; i < rows; i++) {
          for (let j = 0; j < cols; j++) {
            const cell = document.querySelector(`.mine-cell[data-x="${i}"][data-y="${j}"]`);
            if (mineBoard[i][j] === -1 && !cell.classList.contains('flagged')) {
              allFlagsCorrect = false;
              break;
            }
          }
          if (!allFlagsCorrect) break;
        }
        
        if (allFlagsCorrect) {
          gameOver = true;
          clearInterval(timerInterval);
          revealAllCellsExceptFlags();
          setTimeout(() => alert('æ­å–œä½ èµ¢äº†ï¼æ‰€æœ‰ç‚¸å¼¹éƒ½è¢«æ­£ç¡®æ ‡è®°ï¼'), 10);
        }
      }
    }

    // èƒœåˆ©æ—¶æ­å¼€æ‰€æœ‰éæ——æ ¼å­
    function revealAllCellsExceptFlags() {
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const cell = document.querySelector(`.mine-cell[data-x="${i}"][data-y="${j}"]`);
          const contentSpan = cell.querySelector('span');
          
          if (!cell.classList.contains('flagged') && !cell.classList.contains('revealed')) {
            cell.classList.add('revealed');
            
            if (mineBoard[i][j] === -1) {
              cell.classList.add('mine');
              contentSpan.innerHTML = '<span class="emoji">ğŸ’£</span>';
            } else if (mineBoard[i][j] > 0) {
              contentSpan.textContent = mineBoard[i][j];
            }
          }
        }
      }
    }

    // æ­ç¤ºæ‰€æœ‰ç‚¸å¼¹
    function revealAllMines() {
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          if (mineBoard[i][j] === -1) {
            const cell = document.querySelector(`.mine-cell[data-x="${i}"][data-y="${j}"]`);
            if (!cell.classList.contains('flagged')) {
              cell.classList.add('mine');
              cell.querySelector('span').innerHTML = '<span class="emoji">ğŸ’£</span>';
            }
          }
        }
      }
    }

    // æ›´æ–°ç‚¸å¼¹è®¡æ•°
    function updateMineCount() {
      document.getElementById('mine-count').textContent = `å‰©ä½™ç‚¸å¼¹: ${mineCount - flaggedCount}`;
    }

    // æ›´æ–°è®¡æ—¶å™¨
    function updateTimer() {
      const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
      const hours = Math.floor(elapsed / 3600);
      const minutes = Math.floor((elapsed % 3600) / 60);
      const seconds = elapsed % 60;
      
      const formattedTime = 
        `${hours.toString().padStart(2, '0')}:` +
        `${minutes.toString().padStart(2, '0')}:` +
        `${seconds.toString().padStart(2, '0')}`;
      
      document.getElementById('game-time').textContent = `æ—¶é—´: ${formattedTime}`;
    }

    // é‡æ–°å¼€å§‹æ¸¸æˆ
    function restartGame() {
      startGame(rows, cols, mineCount);
    }

    // é€€å‡ºæ¸¸æˆ
    function exitGame() {
      document.getElementById('mine-game').style.display = 'none';
      if (timerInterval) clearInterval(timerInterval);
      document.getElementById('game-info-container').classList.add('hidden');
    }

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
      initSwipe();
      initMusicPlayer();
    });
  </script>
</body>
</html>
